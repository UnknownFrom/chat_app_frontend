<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Чат</title>
    <link rel="stylesheet" href="../assets/css/chat.css">

    <!--<script src="../assets/js/http_code.jquery.com_jquery-3.6.0.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!--<script src="//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js" type="text/javascript"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.3/dist/sockjs.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/centrifugal/centrifuge-js@2.X.X/dist/centrifuge.min.js"></script>
    <script src="../assets/js/centrifuge-js/dist/centrifuge.js" type="text/javascript"></script>
</head>
<body>
    <div class='chat'>
        <div class='chat-messages'>
            <div class='chat-messages__content' id='messages'>
                Загрузка...
            </div>
        </div>
        <div class='chat-input'>
            <form method='post' class="form_message" id='chat-form'>
                <input type='text' id='message-text' class='chat-form__input' placeholder='Введите сообщение'> <input type='submit' id="send" class='chat-form__submit' value='Отправить'>
            </form>
        </div>
    </div>
    <script type="module" src="../assets/js/centrifuge-js/dist/centrifuge.js">

        $.ajax({
            url: 'http://chat.api.loc/index.php',
            method: 'POST',
            dataType: 'JSON',
            data: {user: 'user'},
            success: function (data)
            {
                let centrifuge = new Centrifuge({
                    url: 'http://localhost:8086/connection',
                    user: data.user,
                    timestamp: data.timestamp,
                    token: data.token
                });

                centrifuge.subscribe("news", function(message) {
                    console.log(message);
                });

                centrifuge.connect();
            }
        });
        $('input').on('keyup', function (event)
        {
           if(event.keyCode === 13){

               $(this).val('');
           }
        });
    </script>
    <!--<script type="text/javascript" src="http://chat.api.loc/index.php"></script>-->
    <!--<script src="../assets/js/connect_centrifugo.js"></script>-->
</body>
</html>
